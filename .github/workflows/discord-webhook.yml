name: GitHub All Events to Discord

on:
    # ëª¨ë“  ì´ë²¤íŠ¸ ê°ì§€
    push:
    pull_request:
    issues:
    issue_comment:
    delete:
    release:
    workflow_run:
        workflows: ["*"]
        types:
            - completed

jobs:
    discordNotification:
        runs-on: ubuntu-latest
        steps:
            - name: Send message to Discord
              env:
                  DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
              run: |
                  EVENT_TYPE="${{ github.event_name }}"
                  REPO_NAME="${{ github.repository }}"
                  ACTOR="${{ github.actor }}"

                  # ê¸°ë³¸ ë©”ì‹œì§€
                  MESSAGE="ğŸ“¢ **GitHub ì´ë²¤íŠ¸ ë°œìƒ**\nğŸ”” ì´ë²¤íŠ¸ íƒ€ì…: ${EVENT_TYPE}\nğŸ“Œ ë ˆí¬ì§€í† ë¦¬: ${REPO_NAME}\nğŸ‘¤ ì‹¤í–‰ì: ${ACTOR}\n"

                  # íŠ¹ì • ì´ë²¤íŠ¸ë³„ ì¶”ê°€ ì •ë³´
                  if [[ "$EVENT_TYPE" == "push" ]]; then
                    COMMIT_LIST=""
                    for commit in $(jq -c '.commits[]' <<< '${{ toJson(github.event.commits) }}'); do
                      COMMIT_MESSAGE=$(echo "$commit" | jq -r '.message')
                      COMMIT_URL=$(echo "$commit" | jq -r '.url')
                      COMMIT_AUTHOR=$(echo "$commit" | jq -r '.author.name')
                      COMMIT_LIST="$COMMIT_LIST\nğŸ“ $COMMIT_MESSAGE - ğŸ‘¤ $COMMIT_AUTHOR\nğŸ”— [ì»¤ë°‹ ë³´ê¸°]($COMMIT_URL)"
                    done
                    MESSAGE="$MESSAGE\nğŸ”„ í‘¸ì‹œëœ ì»¤ë°‹ ëª©ë¡:$COMMIT_LIST"
                  fi

                  if [[ "$EVENT_TYPE" == "pull_request" ]]; then
                    PR_TITLE="${{ github.event.pull_request.title }}"
                    PR_URL="${{ github.event.pull_request.html_url }}"
                    PR_STATE="${{ github.event.pull_request.state }}"
                    MESSAGE="$MESSAGE\nğŸ”€ PR ì œëª©: $PR_TITLE\nğŸ“Œ ìƒíƒœ: $PR_STATE\nğŸ”— [PR ë³´ê¸°]($PR_URL)"
                  fi

                  # JSON ë°ì´í„° ìƒì„±
                  PAYLOAD=$(jq -n \
                    --arg username "GitHub Webhook" \
                    --arg content "$MESSAGE" \
                    '{username: $username, content: $content}')

                  echo "Payload: $PAYLOAD" # ë””ë²„ê¹…ìš© ì¶œë ¥

                  # Discord ì›¹í›… ìš”ì²­ ë³´ë‚´ê¸°
                  curl -H "Content-Type: application/json" \
                       -X POST \
                       -d "$PAYLOAD" \
                       "$DISCORD_WEBHOOK_URL"
