name: GitHub All Events to Discord

on:
    # Î™®Îì† Ïù¥Î≤§Ìä∏ Í∞êÏßÄ
    push:
    pull_request:
    issues:
    issue_comment:
    delete:
    release:
    workflow_run:
        workflows: ["*"]
        types:
            - completed

jobs:
    discordNotification:
        runs-on: ubuntu-latest
        steps:
            - name: Send message to Discord
              env:
                  DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
              run: |
                  EVENT_TYPE="${{ github.event_name }}"
                  REPO_NAME="${{ github.repository }}"
                  ACTOR="${{ github.actor }}"

                  # Í∏∞Î≥∏ Î©îÏãúÏßÄ
                  MESSAGE=$(cat <<-EOF
                  üì¢ **GitHub Ïù¥Î≤§Ìä∏ Î∞úÏÉù**
                  üîî Ïù¥Î≤§Ìä∏ ÌÉÄÏûÖ: ${EVENT_TYPE}
                  üìå Î†àÌè¨ÏßÄÌÜ†Î¶¨: ${REPO_NAME}
                  üë§ Ïã§ÌñâÏûê: ${ACTOR}
                  EOF
                  )


                  # Push Ïù¥Î≤§Ìä∏ÏóêÏÑú Î™®Îì† Ïª§Î∞ã Ìè¨Ìï®
                  if [[ "$EVENT_TYPE" == "push" ]]; then
                    COMMIT_LIST=""
                    echo '${{ toJson(github.event.commits) }}' | jq -c '.[]' | while read commit; do
                      COMMIT_MESSAGE=$(echo "$commit" | jq -r '.message')
                      COMMIT_URL=$(echo "$commit" | jq -r '.url')
                      COMMIT_AUTHOR=$(echo "$commit" | jq -r '.author.name')
                      COMMIT_LIST="$COMMIT_LIST\nüìù $COMMIT_MESSAGE - üë§ $COMMIT_AUTHOR\nüîó [Ïª§Î∞ã Î≥¥Í∏∞]($COMMIT_URL)"
                    done

                    # Ïª§Î∞ã Î™©Î°ùÏù¥ ÏûàÏùÑ Í≤ΩÏö∞Îßå Ï∂îÍ∞Ä
                    if [[ -n "$COMMIT_LIST" ]]; then
                      MESSAGE="$MESSAGE\n\nüîÑ **Ìë∏ÏãúÎêú Ïª§Î∞ã Î™©Î°ù:**$COMMIT_LIST"
                    else
                      MESSAGE="$MESSAGE\n\nüîÑ **Ìë∏ÏãúÎêú Ïª§Î∞ãÏù¥ ÏóÜÏäµÎãàÎã§.**"
                    fi
                  fi

                  if [[ "$EVENT_TYPE" == "pull_request" ]]; then
                    PR_TITLE="${{ github.event.pull_request.title }}"
                    PR_URL="${{ github.event.pull_request.html_url }}"
                    PR_STATE="${{ github.event.pull_request.state }}"
                    MESSAGE="$MESSAGE\n\nüîÄ **PR Ï†úÎ™©:** $PR_TITLE\nüìå **ÏÉÅÌÉú:** $PR_STATE\nüîó [PR Î≥¥Í∏∞]($PR_URL)"
                  fi

                  # JSON Îç∞Ïù¥ÌÑ∞ ÏÉùÏÑ± (Here Document ÏÇ¨Ïö©)
                  PAYLOAD=$(jq -n \
                    --arg username "GitHub Webhook" \
                    --arg content "$MESSAGE" \
                    '{username: $username, content: $content}')

                  echo "Payload: $PAYLOAD"  # ÎîîÎ≤ÑÍπÖÏö© Ï∂úÎ†•

                  # Discord ÏõπÌõÖ ÏöîÏ≤≠ Î≥¥ÎÇ¥Í∏∞
                  curl -H "Content-Type: application/json" \
                       -X POST \
                       -d "$PAYLOAD" \
                       "$DISCORD_WEBHOOK_URL"
